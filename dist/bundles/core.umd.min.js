!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/http"),require("rxjs/add/operator/toPromise"),require("@angular/router"),require("@angular/http/testing"),require("@angular/forms")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/http","rxjs/add/operator/toPromise","@angular/router","@angular/http/testing","@angular/forms"],e):e((t.ng=t.ng||{},t.ng.core=t.ng.core||{}),t.ng.core,t._angular_common,t._angular_http,null,t._angular_router,t._angular_http_testing,t._angular_forms)}(this,function(t,e,r,o,n,s,i,u){"use strict";function a(t,e,r){return t.connections.subscribe(function(t){setTimeout(function(){if(!new k(t).requests()&&!new b(t).requests()){var n=new o.Http(r,e),s=new o.RequestOptions({method:t.request.method,headers:t.request.headers,body:t.request.getBody(),url:t.request.url,withCredentials:t.request.withCredentials,responseType:t.request.responseType});n.request(t.request.url,s).subscribe(function(e){t.mockRespond(e)},function(e){t.mockError(e)})}},500)}),new o.Http(t,e)}var c=function(){function t(){}return t.fromJSON=function(e){var r=new t;return r.isStatusOk=e.ok,r.statusCode=e.status,r.headers=e.headers,""!==e._body?r.object=e.json():r.object={},r},t}(),h=new e.InjectionToken("apiUrl.config"),p=function(){function t(t,e){this.baseUrl=t,this.http=e,this.headers=new o.Headers({"Content-Type":"application/json"})}return t.prototype.register=function(t){var e=this;return this.http.post(this.baseUrl+"/register",JSON.stringify(t.toForm()),{headers:this.headers}).toPromise().then(function(t){return e.setToken(t.json().authorization.simpleToken),c.fromJSON(t)}).catch(this.handleError)},t.prototype.login=function(t,e){var r=this,o={credentials:{username:t,password:e}};return this.http.post(this.baseUrl+"/login",JSON.stringify(o),{headers:this.headers}).toPromise().then(function(t){return r.setToken(t.json().authorization.simpleToken),c.fromJSON(t)}).catch(this.handleError)},t.prototype.logout=function(){this.clearSession();var t=new c;return t.isStatusOk=!0,t.statusCode=200,Promise.resolve(t)},t.prototype.recoverPassword=function(t){var e={username:t};return this.http.post(this.baseUrl+"/reset/send-email",JSON.stringify(e),{headers:this.headers}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},t.prototype.resetPassword=function(t,e,r){var o={password:e,passwordConfirmation:r};return this.http.post(this.baseUrl+"/reset-password/"+t,JSON.stringify(o),{headers:this.headers}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},t.prototype.isLoggedIn=function(){return!!this.getToken()},t.prototype.clearSession=function(){this.removeToken()},t.prototype.removeToken=function(){localStorage.removeItem("authorization_token")},t.prototype.setToken=function(t){localStorage.setItem("authorization_token",t)},t.prototype.getToken=function(){return localStorage.getItem("authorization_token")},t.prototype.handleError=function(t){return Promise.reject(c.fromJSON(t))},t}();p.decorators=[{type:e.Injectable}],p.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[h]}]},{type:o.Http}]};var d=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[p,{provide:h,useValue:e}]}},t}();d.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[]}]}],d.ctorParameters=function(){return[]};var l=function(){function t(t){t&&this.decode(t)}return t.prototype.getFormContent=function(){var e={},r=this;return Object.keys(this).map(function(o){var n=r[o];"id"!==o&&(n instanceof t&&n.id?e[o]=n.id:Array.isArray(n)?n.length>0&&(e[o]=[],n.map(function(t){e[o].push(t.getFormContent())})):e[o]=n)}),e},t.prototype.toForm=function(){var t={};return t[this.getFormEntityName()]=this.getFormContent(),t},t}(),f=function(){function t(){}return t.MatchPassword=function(t){if(t.get("password").value===t.get("repeatPassword").value)return null;t.get("repeatPassword").setErrors({MatchPassword:!0})},t}(),g=function(){function t(t,e,r){this.apiUrl=t,this.auth=e,this.http=r,this.apiVersion="v1.0",this.defaultHeaders=new o.Headers({"Content-Type":"application/json"})}return t.prototype.getBaseUrl=function(){return this.apiUrl+"/"+this.apiVersion},t.prototype.getHeaders=function(){var t=Object.assign(this.defaultHeaders.toJSON(),{Authorization:this.auth.getToken()});return new o.Headers(t)},t.prototype.getList=function(){var t=this;return this.http.get(this.getEntityBaseUrl(),{headers:this.getHeaders()}).toPromise().then(function(e){return e.json().result.map(function(e){return t.createEntity(e)})}).catch(this.handleError)},t.prototype.getOne=function(t){var e=this.getEntityBaseUrl()+"/"+t,r=this;return this.http.get(e,{headers:this.getHeaders()}).toPromise().then(function(t){return r.createEntity(t.json().result)}).catch(this.handleError)},t.prototype.remove=function(t){var e=this.getEntityBaseUrl()+"/"+t;return this.http.delete(e,{headers:this.getHeaders()}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},t.prototype.create=function(t){return this.http.post(this.getEntityBaseUrl(),JSON.stringify(t.toForm()),{headers:this.getHeaders()}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},t.prototype.update=function(t){var e=this.getEntityBaseUrl()+"/"+t.id;return this.http.patch(e,JSON.stringify(t.toForm()),{headers:this.getHeaders()}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},t.prototype.change=function(t){var e=this.getEntityBaseUrl()+"/"+t.id;return this.http.put(e,JSON.stringify(t.toForm()),{headers:this.getHeaders()}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},t.prototype.handleError=function(t){return console.error("An error occurred",t),Promise.reject(c.fromJSON(t))},t}();g.decorators=[{type:e.Injectable}],g.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[h]}]},{type:p},{type:o.Http}]};var m=function(){function t(t,e){this.authService=t,this.router=e,this.loginRoute="/login"}return t.prototype.canActivate=function(t,e){var r=e.url;return this.checkLogin(r)},t.prototype.canActivateChild=function(t,e){return this.canActivate(t,e)},t.prototype.canDeactivate=function(t,e,r){var o=r.url;return this.checkLogout(o)},t.prototype.checkLogin=function(t){return!!this.authService.isLoggedIn()||(this.authService.redirectUrl=t,this.router.navigate([this.loginRoute]),!1)},t.prototype.checkLogout=function(t){return!this.authService.isLoggedIn()||(this.router.navigate([""]),!1)},t}();m.decorators=[{type:e.Injectable}],m.ctorParameters=function(){return[{type:p},{type:s.Router}]};var y=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),v=function(t){function e(e){return t.call(this,new o.ResponseOptions(e))||this}return y(e,t),e}(o.Response),S=function(){function t(t){this.connection=t}return t.prototype.mockRespond=function(t){this.connection.mockRespond(new o.Response(new o.ResponseOptions(t)))},t.prototype.mockError=function(t){this.connection.mockError(new v(t))},t}(),O=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),k=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.users=e.getUsers(),r}return O(e,t),e.getUsers=function(){var t=localStorage.getItem("users"),e=t?JSON.parse(t):[];if(0===e.length){e=[{id:1,authorizationSimpleToken:"1",firstName:"Francisco",lastName:"Rodríguez",secondLastName:"Fernández",phone:"+56293214008",cellPhone:"+56993214008",email:"frodriguez@option.cl",bornDate:null,sex:null,healthCare:null,password:"a12345678",avatar:"http://via.placeholder.com/160x160/F1F1F2"}],localStorage.setItem("users",JSON.stringify(e))}return e},e.getUserByAuthorizationSimpleToken=function(t){return e.getUsers().filter(function(e){return e.authorizationSimpleToken===t})[0]},e.prototype.requests=function(){var t=localStorage.getItem("users"),e=t?JSON.parse(t):[];if(this.connection.request.url.endsWith("/login")&&this.connection.request.method===o.RequestMethod.Post){var r=JSON.parse(this.connection.request.getBody()),n=r.credentials,s=this.login(n.username,n.password);return s?this.mockRespond({status:200,body:s}):this.mockError({status:401,statusText:"Username or password is incorrect"}),!0}if(this.connection.request.url.endsWith("/register")&&this.connection.request.method===o.RequestMethod.Post){var i=JSON.parse(this.connection.request.getBody()),u=i[Object.keys(i)[0]];if(e.filter(function(t){return t.email===u.email}).length)return this.mockError({status:400,statusText:"Username "+u.username+" is already taken"}),!0;u.id=e.length+1;var a=this.createAuthorizationBody(u);return u.authorizationSimpleToken=a.authorization.simpleToken,e.push(u),localStorage.setItem("users",JSON.stringify(e)),this.mockRespond({status:200,body:a}),!0}if(this.connection.request.url.endsWith("/reset/send-email")&&this.connection.request.method===o.RequestMethod.Post){var i=JSON.parse(this.connection.request.getBody());return this.mockRespond({status:200,body:{}}),!0}var c=new RegExp("reset-password/.*$");if(this.connection.request.url.match(c)&&this.connection.request.method===o.RequestMethod.Post){var i=JSON.parse(this.connection.request.getBody());return this.mockRespond({status:200,body:{}}),!0}return!1},e.prototype.login=function(t,e){var r=this.users.filter(function(r){return r.username===t&&r.password===e});if(r.length){var o=r[0];return this.createAuthorizationBody(o)}},e.prototype.createAuthorizationBody=function(t){return{authorization:{simpleToken:t.id+""}}},e}(S),E=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.localStorageResources=localStorage.getItem(e.getLocalStorageKey()),e.resources=e.localStorageResources?JSON.parse(e.localStorageResources):[],e}return E(e,t),e.prototype.hasSecurityMock=function(){return!0},e.prototype.generateBody=function(t){var e={filterBy:[],limit:20,offset:0,orderBy:[],pretty:!1,resultDescription:this.getResourceName(),select:[],result:t};return Array.isArray(t)&&(e.total=t.length||1),e},e.prototype.isAuthorizedUser=function(){var t=this.connection.request.headers.get("Authorization")||"";return!!k.getUserByAuthorizationSimpleToken(t)},e.prototype.requests=function(){if(this.connection.request.url.endsWith(this.getResourceEndpoint())&&this.connection.request.method===o.RequestMethod.Get)return!this.hasSecurityMock()||this.isAuthorizedUser()?this.mockRespond({status:200,body:this.generateBody(this.resources)}):this.mockError({status:400,statusText:"not authorized"}),!0;var t=new RegExp(this.getResourceEndpoint()+"/\\d+$");if(this.connection.request.url.match(t)&&this.connection.request.method===o.RequestMethod.Get){if(!this.hasSecurityMock()||this.isAuthorizedUser()){var e=this.connection.request.url.split("/"),r=Number.parseInt(e[e.length-1]),n=this.resources.filter(function(t){return t.id===r}),s=n.length?n[0]:null;this.mockRespond({status:200,body:this.generateBody(s)})}else this.mockError({status:400,statusText:"not authorized"});return!0}if(this.connection.request.url.endsWith(this.getResourceEndpoint())&&this.connection.request.method===o.RequestMethod.Post){var i=JSON.parse(this.connection.request.getBody()),u=i[Object.keys(i)[0]];return!this.hasSecurityMock()||this.isAuthorizedUser()?(u.id=this.resources.length+1,this.resources.push(u),localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(this.resources)),this.mockRespond({status:200})):this.mockError({status:400,statusText:"not authorized"}),!0}var a=new RegExp(this.getResourceEndpoint()+"/\\d+$");if(this.connection.request.url.match(a)&&this.connection.request.method===o.RequestMethod.Patch){var i=JSON.parse(this.connection.request.getBody()),c=i[Object.keys(i)[0]];if(!this.hasSecurityMock()||this.isAuthorizedUser()){var e=this.connection.request.url.split("/"),h=Number.parseInt(e[e.length-1]),p=void 0;for(p=0;p<this.resources.length;p++){var s=this.resources[p];if(s.id===h)break}this.resources[p]?(this.resources[p]=Object.assign(this.resources[p],c),localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(this.resources)),this.mockRespond({status:200})):this.mockError({status:404,statusText:"not found"})}else this.mockError({status:400,statusText:"not authorized"});return!0}return!1},e}(S),q=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return q(e,t),e.prototype.getResourceEndpoint=function(){return"/users"},e.prototype.getLocalStorageKey=function(){return"users"},e.prototype.getResourceName=function(){return"users"},e.prototype.requests=function(){var e=this.connection.request.url,r=this.connection.request.method,n=this.getResourceEndpoint()+"/me";if(e.endsWith(n)&&r===o.RequestMethod.Get){if(this.isAuthorizedUser()){var s=this.connection.request.headers.get("Authorization")||"",i=k.getUserByAuthorizationSimpleToken(s),u=this.generateBody(i);this.mockRespond({status:200,body:u})}else this.mockError({status:401});return!0}var a=this.getResourceEndpoint()+"/me/password";if(e.endsWith(a)&&r===o.RequestMethod.Post){if(this.isAuthorizedUser()){var c=JSON.parse(this.connection.request.getBody()),s=this.connection.request.headers.get("Authorization")||"",i=k.getUserByAuthorizationSimpleToken(s);if(i.password===c.oldPassword){var h=void 0;for(h=0;h<this.resources.length;h++){if(this.resources[h].id===i.id)break}i.password=c.password,this.resources[h]=Object.assign(this.resources[h],i),localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(this.resources)),this.mockRespond({status:200})}else this.mockError({status:400,message:"incorrect password"})}else this.mockError({status:401});return!0}return t.prototype.requests.call(this)},e}(_),w={provide:o.Http,useFactory:a,deps:[i.MockBackend,o.BaseRequestOptions,o.XHRBackend]},P=function(){function t(t){this.formBuilder=t,this.submitted=!1,this.serverMessage={message:"Server message",show:!1,isStatusOk:!0},this.SERVER_MESSAGES={401:"Unauthorized message",403:"Forbidden message"},this.formErrors={},this.VALIDATION_MESSAGES={},this.PLACEHOLDERS={},this.SUBMIT_LABEL="Submit label",this.formBuilderGroupControlsConfig={field1:[null,[u.Validators.required,u.Validators.email]],field2:[null,[u.Validators.required,u.Validators.minLength(8)]]}}return t.prototype.ngOnInit=function(){this.buildForm()},t.prototype.isFromValid=function(){return this.form.valid},t.prototype.onSubmit=function(){var t=this;t.submitted=!0,t.onValueChanged(),t.isFromValid()&&this.submit()},t.prototype.buildForm=function(){var t=this;this.form=this.formBuilder.group(this.formBuilderGroupControlsConfig,this.formBuilderGroupExtra),this.form.valueChanges.subscribe(function(e){return t.onValueChanged(e)}),this.onValueChanged()},t.prototype.onValueChanged=function(t){if(this.form){var e=this.form;for(var r in this.formErrors){this.formErrors[r]="";var o=e.get(r);if(o&&o.dirty&&!o.valid||this.submitted){var n=this.VALIDATION_MESSAGES[r];for(var s in o.errors)""===this.formErrors[r]&&(this.formErrors[r]=n[s])}}}},t}(),R=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R(e,t),e.prototype.getFormEntityName=function(){return"user"},e.prototype.decode=function(t){this.id=t.id,this.fullName=t.fullName,this.username=t.username,this.password=t.password,this.email=t.email,this.roles=t.roles,this.phoneNumber=t.phoneNumber},e.prototype.setFullName=function(t,e){this.fullName=t+" "+e},e}(l),A=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return A(e,t),e.prototype.getEntityBaseUrl=function(){return this.getBaseUrl()+"/users"},e.prototype.createEntity=function(t){return new N(t)},e.prototype.getMe=function(){if(this.user)return Promise.resolve(this.user);var t=this;return this.http.get(this.getEntityBaseUrl()+"/me",{headers:this.getHeaders()}).toPromise().then(function(e){return t.user=t.createEntity(e.json().result)}).catch(this.handleError)},e.prototype.changePassword=function(t,e,r){var o={oldPassword:t,password:e,passwordConfirmation:r};return this.http.post(this.getEntityBaseUrl()+"/me/password",JSON.stringify(o),{headers:this.getHeaders()}).toPromise().then(function(t){return c.fromJSON(t)}).catch(this.handleError)},e}(g);B.decorators=[{type:e.Injectable}],B.ctorParameters=function(){return[]},t.OptionCoreModule=d,t.API_URL=h,t.OptEntity=l,t.OptResponse=c,t.OptPasswordValidation=f,t.OptRestService=g,t.OptAuthService=p,t.OptAuthGuard=m,t.AuthMock=k,t.fakeBackendFactory=a,t.fakeBackendProvider=w,t.MockError=v,t.Mock=S,t.RestMock=_,t.UserMock=b,t.OptFormComponent=P,t.OptUser=N,t.OptUserService=B,Object.defineProperty(t,"__esModule",{value:!0})});